# Agentic RAG å¤šSub Agentæ¶æ„

åŸºäºGoogle ADKæ¡†æ¶çš„æ™ºèƒ½æ³•å¾‹å’¨è¯¢ç³»ç»Ÿï¼Œé‡‡ç”¨å¤šSub Agentæ¶æ„å®ç°é«˜çº§RAGåŠŸèƒ½ã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
root_agent (ä¸»åè°ƒå™¨)
â”œâ”€â”€ å·¥å…·å±‚
â”‚   â”œâ”€â”€ agentic_legal_consultation (æ™ºèƒ½å’¨è¯¢)
â”‚   â””â”€â”€ retrieve_docs (ç®€å•æ£€ç´¢)
â”œâ”€â”€ æ£€ç´¢å±‚
â”‚   â””â”€â”€ LocalRetriever (BGE-M3 + FAISS + Cross-encoder)
â””â”€â”€ å­ä»£ç†å±‚
    â”œâ”€â”€ query_analyzer (æŸ¥è¯¢åˆ†æå™¨)
    â”œâ”€â”€ query_rewriter (æŸ¥è¯¢é‡å†™å™¨)  
    â”œâ”€â”€ retrieval_evaluator (æ£€ç´¢è¯„ä¼°å™¨)
    â””â”€â”€ answer_evaluator (ç­”æ¡ˆè¯„ä¼°å™¨)
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½æŸ¥è¯¢åˆ†æ
- **å¤æ‚åº¦è¯„ä¼°**: simple | medium | complex
- **ç±»å‹è¯†åˆ«**: factual | procedural | comparative | analytical
- **é¢†åŸŸåˆ†ç±»**: criminal | civil | commercial | administrative | general
- **ç­–ç•¥é€‰æ‹©**: direct | decompose | multi_round

### 2. è‡ªé€‚åº”æ£€ç´¢ç­–ç•¥
- **ç›´æ¥æ£€ç´¢**: ç®€å•æŸ¥è¯¢çš„å¿«é€Ÿå¤„ç†
- **åˆ†è§£æ£€ç´¢**: å¤æ‚æŸ¥è¯¢çš„å­é—®é¢˜å¤„ç†
- **å¤šè½®æ£€ç´¢**: ç»“åˆæŸ¥è¯¢é‡å†™çš„è¿­ä»£ä¼˜åŒ–

### 3. è´¨é‡è¯„ä¼°ä½“ç³»
- **æ£€ç´¢è´¨é‡**: ç›¸å…³æ€§ã€å®Œæ•´æ€§ã€å‡†ç¡®æ€§ã€å¤šæ ·æ€§
- **ç­”æ¡ˆè´¨é‡**: å‡†ç¡®æ€§ã€å®Œæ•´æ€§ã€é€»è¾‘æ€§ã€å¯ç”¨æ€§

### 4. é«˜çº§æ£€ç´¢æŠ€æœ¯
- **å‘é‡æ£€ç´¢**: BGE-M3åµŒå…¥æ¨¡å‹
- **é‡æ’åº**: Cross-encoderç²¾ç¡®æ’åº
- **æŸ¥è¯¢é‡å†™**: å¤šå˜ä½“ç”Ÿæˆæé«˜è¦†ç›–ç‡

## ğŸ“¦ å®‰è£…å’Œé…ç½®

### ç¯å¢ƒè¦æ±‚
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd /path/to/adk-samples/python/agents
source venv/bin/activate
cd agentic_rag
```

### åˆå§‹åŒ–ç´¢å¼•
```bash
# å»ºç«‹æ³•å¾‹æ–‡æœ¬ç´¢å¼•
python init_index.py
```

### é…ç½®APIå¯†é’¥
```python
# åœ¨ agentic_rag/config.py ä¸­é…ç½®
DEEPSEEK_API_KEY = "your_api_key_here"
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡Œå®Œæ•´æµ‹è¯•
```bash
python test_simple.py
```

### æµ‹è¯•å†…å®¹
- âœ… æ£€ç´¢å™¨åˆå§‹åŒ– (74æ¡æ³•å¾‹æ¡æ–‡)
- âœ… Sub Agentså®šä¹‰ (4ä¸ªä¸“é—¨ä»£ç†)
- âœ… ä¸»Agentå®šä¹‰ (2å·¥å…·+4å­ä»£ç†)
- âœ… å·¥å…·å‡½æ•° (æ™ºèƒ½å’¨è¯¢+ç®€å•æ£€ç´¢)

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### 1. æ™ºèƒ½æ³•å¾‹å’¨è¯¢
```python
from agentic_rag.agent import agentic_legal_consultation

result = agentic_legal_consultation("å…¬å¸æ‹–æ¬ å·¥èµ„æ€ä¹ˆåŠï¼Ÿ")
print(result)
```

### 2. ç®€å•æ£€ç´¢
```python  
from agentic_rag.agent import retrieve_docs

result = retrieve_docs("åŠ³åŠ¨åˆåŒè¿çº¦")
print(result)
```

### 3. ADKé›†æˆä½¿ç”¨
```python
from agentic_rag.agent import root_agent

# ADKæ¡†æ¶ä¼šè‡ªåŠ¨åè°ƒsub_agents
# ç”¨æˆ·æŸ¥è¯¢ä¼šæ ¹æ®å¤æ‚åº¦è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å¤„ç†ç­–ç•¥
```

## ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹

### ADKåŸç”Ÿæ¶æ„
- ä½¿ç”¨ADKæ¡†æ¶çš„`sub_agents`å‚æ•°
- è‡ªåŠ¨Agentåè°ƒå’Œä»»åŠ¡åˆ†å‘
- æ ‡å‡†åŒ–çš„Agenté—´é€šä¿¡

### æ™ºèƒ½å·¥ä½œæµç¨‹
1. **æŸ¥è¯¢æ¥æ”¶** â†’ ä¸»Agentæ¥æ”¶ç”¨æˆ·æŸ¥è¯¢
2. **æ™ºèƒ½åˆ†æ** â†’ query_analyzerè¯„ä¼°æŸ¥è¯¢ç‰¹å¾
3. **ç­–ç•¥é€‰æ‹©** â†’ æ ¹æ®åˆ†æç»“æœé€‰æ‹©å¤„ç†ç­–ç•¥
4. **æ£€ç´¢æ‰§è¡Œ** â†’ LocalRetrieveræ‰§è¡Œå‘é‡æ£€ç´¢+é‡æ’åº
5. **è´¨é‡è¯„ä¼°** â†’ retrieval_evaluatorè¯„ä¼°æ£€ç´¢è´¨é‡
6. **ç­”æ¡ˆç”Ÿæˆ** â†’ åŸºäºæ£€ç´¢ç»“æœç”Ÿæˆä¸“ä¸šç­”æ¡ˆ
7. **ç­”æ¡ˆè¯„ä¼°** â†’ answer_evaluatorè¯„ä¼°ç­”æ¡ˆè´¨é‡

### æ€§èƒ½ä¼˜åŒ–
- **æœ¬åœ°ç¼“å­˜**: æ¨¡å‹è‡ªåŠ¨ç¼“å­˜åˆ°æœ¬åœ°
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡æŸ¥è¯¢å¤„ç†
- **å¢é‡ç´¢å¼•**: æ”¯æŒåŠ¨æ€æ·»åŠ æ³•å¾‹æ–‡æ¡£

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ£€ç´¢æ€§èƒ½
- **ç´¢å¼•å¤§å°**: 74æ¡æ³•å¾‹æ¡æ–‡
- **æ£€ç´¢é€Ÿåº¦**: < 1ç§’ (top_k=10)
- **é‡æ’åº**: Cross-encoderç²¾ç¡®æ’åº

### æ¨¡å‹é…ç½®
- **åµŒå…¥æ¨¡å‹**: BAAI/bge-m3 (å¤šè¯­è¨€)
- **é‡æ’åºæ¨¡å‹**: cross-encoder/ms-marco-MiniLM-L-6-v2
- **ç”Ÿæˆæ¨¡å‹**: DeepSeek-Chat (ä¸­æ–‡ä¼˜åŒ–)

## ğŸ”® æ‰©å±•æ–¹å‘

### 1. æ›´å¤šSub Agents
- **æ³•æ¡è§£é‡Šå™¨**: ä¸“é—¨è§£é‡Šæ³•å¾‹æ¡æ–‡
- **æ¡ˆä¾‹åˆ†æå™¨**: åˆ†æç›¸å…³åˆ¤ä¾‹
- **é£é™©è¯„ä¼°å™¨**: è¯„ä¼°æ³•å¾‹é£é™©

### 2. é«˜çº§åŠŸèƒ½
- **å¤šè½®å¯¹è¯**: æ”¯æŒä¸Šä¸‹æ–‡è®°å¿†
- **ä¸ªæ€§åŒ–**: æ ¹æ®ç”¨æˆ·å†å²ä¼˜åŒ–
- **å®æ—¶æ›´æ–°**: æ³•å¾‹æ¡æ–‡åŠ¨æ€æ›´æ–°

### 3. é›†æˆæ‰©å±•
- **Webç•Œé¢**: Streamlit/Gradioç•Œé¢
- **APIæœåŠ¡**: RESTful APIæ¥å£
- **ç§»åŠ¨ç«¯**: ç§»åŠ¨åº”ç”¨é›†æˆ

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„Sub Agent
```python
# åœ¨ sub_agents_adk.py ä¸­å®šä¹‰
new_agent = Agent(
    name="new_agent",
    model=LiteLlm(model="deepseek/deepseek-chat"),
    description="æ–°Agentçš„åŠŸèƒ½æè¿°",
    instruction="è¯¦ç»†çš„æŒ‡ä»¤è¯´æ˜",
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    generate_content_config=types.GenerateContentConfig(...)
)

# åœ¨ agent.py ä¸­æ³¨å†Œ
sub_agents=[
    query_analyzer,
    query_rewriter,
    retrieval_evaluator,
    answer_evaluator,
    new_agent  # æ·»åŠ æ–°Agent
]
```

### è‡ªå®šä¹‰æ£€ç´¢ç­–ç•¥
```python
# åœ¨ CoordinatorAgent ä¸­å®ç°æ–°ç­–ç•¥
def custom_retrieval_strategy(self, query, analysis):
    # å®ç°è‡ªå®šä¹‰æ£€ç´¢é€»è¾‘
    pass
```

## ğŸ¯ æ€»ç»“

è¿™ä¸ªå¤šSub Agentæ¶æ„å®ç°äº†çœŸæ­£çš„Agentic RAGç³»ç»Ÿï¼š

- **æ™ºèƒ½åŒ–**: è‡ªä¸»åˆ†ææŸ¥è¯¢å¹¶é€‰æ‹©ç­–ç•¥
- **ä¸“ä¸šåŒ–**: æ¯ä¸ªAgentä¸“æ³¨ç‰¹å®šåŠŸèƒ½
- **æ ‡å‡†åŒ–**: éµå¾ªADKæ¡†æ¶æœ€ä½³å®è·µ
- **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„Agentå’ŒåŠŸèƒ½

ç³»ç»Ÿå·²é€šè¿‡å®Œæ•´æµ‹è¯•éªŒè¯ï¼Œå¯ä»¥ä¸ºä¸­æ–‡æ³•å¾‹å’¨è¯¢æä¾›ä¸“ä¸šã€å‡†ç¡®çš„æ™ºèƒ½æœåŠ¡ã€‚
